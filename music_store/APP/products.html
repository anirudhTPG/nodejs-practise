<!DOCTYPE html>
<html lang="en">
   <head>
      <!-- basic -->
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <!-- mobile metas -->
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="viewport" content="initial-scale=1, maximum-scale=1">
      <!-- site metas -->
      <title>sungla</title>
      <meta name="keywords" content="">
      <meta name="description" content="">
      <meta name="author" content="">
      <!-- bootstrap css -->
      <link rel="stylesheet" href="css/bootstrap.min.css">
      <!-- style css -->
      <link rel="stylesheet" href="css/style.css">
      <!-- Responsive-->
      <link rel="stylesheet" href="css/responsive.css">
      <!-- fevicon -->
      <link rel="icon" href="images/fevicon.png" type="image/gif" />
      <!-- Scrollbar Custom CSS -->
      <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
      <!-- Tweaks for older IEs-->
      <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
      <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]-->
   </head>
   <!-- body -->
   <body class="main-layout position_head">
      <!-- loader  -->
      <div class="loader_bg">
         <div class="loader"><img src="images/loading.gif" alt="#" /></div>
      </div>
      <!-- end loader -->
      <!-- header -->
      <header>
         <!-- header inner -->
         <div class="header">
            <div class="container-fluid">
               <div class="row">
                  <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col logo_section">
                     <div class="full">
                        <div class="center-desk">
                           <div class="logo">
                              <a href="index.html"><img src="images/logo.png" alt="#" /></a>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9">
                     <nav class="navigation navbar navbar-expand-md navbar-dark ">
                        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarsExample04">
                           <ul class="navbar-nav mr-auto">
                              <li class="nav-item">
                                 <a class="nav-link" href="index.html">Home</a>
                              </li>
                              <li class="nav-item active">
                                 <a class="nav-link" href="products.html">Products</a>
                              </li>
                              <li class="nav-item">
                                 <a class="nav-link" href="shop.html">Shopping Cart</a>
                              </li>
                              <li class="nav-item d_none login_btn">
                                 <a class="nav-link" href="#" id="btn_logout">Logout</a>
                              </li>
                              <li class="nav-item d_none sea_icon">
                                 <a class="nav-link" href="#"><i class="fa fa-shopping-bag" aria-hidden="true"></i><i class="fa fa-search" aria-hidden="true"></i></a>
                              </li>
                           </ul>
                        </div>
                     </nav>
                  </div>
               </div>
            </div>
         </div>
      </header>
      <!-- end header inner -->
      <!-- end header -->
      <!-- Our  Glasses section -->
      <div class="glasses">
         <div class="container">
            <div class="row">
               <div class="col-sm-6">
                 <form name="frm" method="POST" action="">                  
                  <div class="form-group">
                     <h2>Online Music Library - Add Product(Tracks)</h2>
                  </div>
                  <div class="form-group">
                    <input type="text" name="albumGenre" id="albumGenre" value="" class="form-control" placeholder="Album Genre">
                  </div>
                  <div class="form-group">
                    <input type="text" name="albumName" id="albumName" value="" class="form-control" placeholder="Album Name">
                  </div>                  
                  <div class="form-group">
                     <input type="text" name="albumYear" id="albumYear" value="" class="form-control" placeholder="Album Year">
                   </div>
                   <div class="form-group">
                     <input type="text" name="artistName" id="artistName" value="" class="form-control" placeholder="Artist Name">
                   </div>
                   <div class="form-group">
                     <input type="text" name="trackName" id="trackName" value="" class="form-control" placeholder="Track Name">
                   </div>
                   <div class="form-group">
                     <input type="text" name="trackPrice" id="trackPrice" value="" class="form-control" placeholder="Track Price">
                   </div>

                  <input type="submit" name="Update" id="update" value="Add Track" />
                </form>
               </div>
                <div class="col-sm-6">
                  <div class="col-sm-12">
                     <h2>Product List (Tracks)</h2>
                  </div>
                  <table class="table"  id="records_table">
                     <thead>
                       <tr>
                         <th scope="col">Track Name</th>
                         <th scope="col">Artist</th>
                         <th scope="col"></th>
                       </tr>
                     </thead>
                   </table>
                </div>


            </div>
         </div>
      </div>
      <!-- end Our  Glasses section -->
      <!--  footer -->
      <footer>
         <div class="footer">
            <div class="container">
               <div class="row">
                  <div class="col-md-8 offset-md-2">
                     <ul class="location_icon">
                        <li><a href="#"><i class="fa fa-map-marker" aria-hidden="true"></i></a><br> Location</li>
                        <li><a href="#"><i class="fa fa-phone" aria-hidden="true"></i></a><br> +01 1234567890</li>
                        <li><a href="#"><i class="fa fa-envelope" aria-hidden="true"></i></a><br> demo@gmail.com</li>
                     </ul>
                  </div>
               </div>
            </div>
            <div class="copyright">
               <div class="container">
                  <div class="row">
                     <div class="col-md-12">
                        <p>Â© 2019 All Rights Reserved. Design by<a href="https://html.design/"> Free Html Templates</a></p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </footer>
      <!-- end footer -->
      <!-- Javascript files-->
      <script src="js/jquery.min.js"></script>
      <script src="js/popper.min.js"></script>
      <script src="js/bootstrap.bundle.min.js"></script>
      <script src="js/jquery-3.0.0.min.js"></script>
      <!-- sidebar -->
      <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
      <script src="js/custom.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.1/dist/js.cookie.min.js"></script>
      <script type="text/javascript">
         $(document).ready(function(){
            //check if cookies exits
            if(Cookies.get('node_role')){
               var role = Cookies.get('node_role');
               if(role == 'administrator'){

               }else{
                  window.location.href = 'userproducts.html';
               }

            }else{
               console.log('Not logged-in user');
               window.location.href = 'login.html';
            }

            //get tracks
            $.ajax({
                  type:'GET',
                  beforeSend: function (xhr) {
                     xhr.setRequestHeader('Authorization', 'Bearer ' + Cookies.get('node_token'));
                  }, 
                  url:'http://localhost:9090/tracks/get',
                  success:function(response, xhr) {
                                console.log('ajax response:', response.tracks); 
                                console.log('ajax xhr:', xhr); 

                                var trHTML = '';
                                 $.each(response.tracks, function (i, item) {
                                       trHTML += '<tr><td>' + item.trackName + '</td><td>' + item.artistName + '</td><td><button type="button" class="btn btn-danger" id="' + item._id +'">Delete Track</button></td></tr>';
                                 });
                                 $('#records_table').append(trHTML);      

                  }
               });


            //Add tracks
            $("#update").click(function(e) {
               e.preventDefault();
               //, , , , 
               var albumGenre = $("#albumGenre").val(); 
               var albumName = $("#albumName").val();
               var albumYear = $("#albumYear").val();
               var artistName = $("#artistName").val();
               var trackName = $("#trackName").val();
               var trackPrice = $("#trackPrice").val();

               $.ajax({
                  type:'POST',
                  beforeSend: function (xhr) {
                     xhr.setRequestHeader('Authorization', 'Bearer ' + Cookies.get('node_token'));
                  }, 
                  data:{albumGenre:albumGenre, albumName:albumName, albumYear:albumYear, artistName:artistName, trackName:trackName, trackPrice:trackPrice},
                  url:'http://localhost:9090/tracks/create',
                  success:function(response, xhr) {
                                console.log('ajax response:', response); 
                                console.log('ajax xhr:', xhr); 
                                //alert('data saved successfully');
                                 
                                window.location.reload();
                              //   $("#albumGenre").val(''); 
                              //   $("#albumName").val('');
                              //   $("#albumYear").val('');
                              //   $("#artistName").val('');
                              //   $("#trackName").val('');
                              //   $("#trackPrice").val('');
                  }
               });
            });


            //delete tracks
            $(document).on('click', 'button',function(){
               //alert(this.id);
               $.ajax({
                  type:'DELETE',
                  beforeSend: function (xhr) {
                     xhr.setRequestHeader('Authorization', 'Bearer ' + Cookies.get('node_token'));
                  }, 
                  url:'http://localhost:9090/tracks/delete/'+this.id,
                  success:function(response, xhr) {
                                console.log('ajax response:', response); 
                                console.log('ajax xhr:', xhr);  
                                window.location.reload();
                  }
               });
            });



            //logout btn 
            $("#btn_logout").click(function(){
               if(Cookies.get('node_role')){
                  console.log('remove role')
                  Cookies.remove('node_role', { path: '/' });
               }

               console.log('node_role',Cookies.get('node_token'));   
               if(Cookies.get('node_token')){
                  console.log('remove token')
                  Cookies.remove('node_token', { path: '/' });
               }
               
               if(Cookies.get('node_username')){
                  console.log('remove username')
                  Cookies.remove('node_username', { path: '/' });
               }
               window.location.href = 'login.html';
            });
         });
      </script>
   </body>
</html>

